<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="lambda.png">
    <title>Demo</title>
    <script>

        const LOGO_CONFIG = {
            attributes: {
                src: 'https://rxjs.dev/generated/images/marketing/home/Rx_Logo-512-512.png',
                width: '50px',
            },
            margin: 20, // Safe margin to stay away from window border
            interval: 1000, // Milliseconds between consequitive repositioning of logo
        }

        function createLogo(logo_config) {
            const style = { position: 'fixed', transition: `left ${logo_config.interval}ms linear, top ${logo_config.interval}ms linear` }
            const logo = document.createElement('img');
            Object.entries(logo_config.attributes).forEach(([atr, value]) => logo.setAttribute(atr, value));
            Object.entries(style).forEach(([stylename, value]) => logo.style[stylename] = value);
            return logo;
        }

        function getSafeFrame(element, w = window, margin = LOGO_CONFIG.margin) {
            let [minX, maxX, minY, maxY] = [margin, w.innerWidth - element.offsetWidth - margin, margin, w.innerHeight - element.offsetHeight - margin];
            if ( maxX < minX ) minX = maxX = (w.innerWidth - elem.offsetWidth) / 2;
            if ( maxY < minY ) minY = maxY = (w.innerHeight - elem.offsetHeight) / 2;
            return { minX, maxX, minY, maxY }
        }

        function toPercent(part, total) {
            return 100 * part / total
        }

        /** Set element to a known position */
        function setPosition(element, {x, y}, w = window) {
            if ( typeof x === 'number' ) element.style.left = toPercent(x, w.innerWidth) + '%';
            if ( typeof y === 'number' ) element.style.top = toPercent(y, w.innerHeight) + '%';
        }

        function elementMoveTo(element, pos /* +1=>'top'; -1=>'bottom' */, w = window, margin = LOGO_CONFIG.margin) {
            const frame = getSafeFrame(element, w, margin)
            if ( pos > 0 ) setPosition(element, {x: frame.minX, y: frame.minY })
            else setPosition(element, {x: frame.minX, y: frame.maxY})
        }

        function initialize() {
            const logo = createLogo(LOGO_CONFIG)
            elementMoveTo(logo, +1);
            document.body.appendChild(logo)
            let timeout;
            oscilate = (element, dir /* +1=>'top'; -1=>'bottom' */, w, margin, interval) => {
                elementMoveTo(element, dir, w, margin)
                timeout = setTimeout(oscilate, interval, /* params */ ...[element, -dir, w, margin, interval])
            }
            logoStart = () => {
                oscilate(logo, -1 /* bottom */, window, LOGO_CONFIG.margin, LOGO_CONFIG.interval)
            };
            logoStop = () => {
                clearTimeout(timeout);
                elementMoveTo(logo, +1, LOGO_CONFIG.margin)
            }
            console.log(`Perform non-blocking test:\n${' '.repeat(10)}start: %c${logoStart.name}()%c, stop: %c${logoStop.name}()`, 'color:red', '', 'color:red');
        }

        window.addEventListener('load', initialize)

    </script>
</head>
<body>
</body>
</html>
